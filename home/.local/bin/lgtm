#!/usr/bin/env bash
# Generate commit message from diff using Claude

diff=$(git diff --cached)
[ -z "$diff" ] && diff=$(git diff)
[ -z "$diff" ] && echo "no changes" && exit 1

msg=$(echo "$diff" | claude -p --model haiku "write a one-line commit msg for this diff. conventional commit format. just the message, nothing else.")

echo "$msg"
if [[ "$1" == "-y" ]]; then
  git commit -m "$msg"
else
  read -p "commit? [y/N] " -n 1 -r
  echo
  [[ $REPLY =~ ^[Yy]$ ]] && git commit -m "$msg"
fi
